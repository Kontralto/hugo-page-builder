{{ $scratch :=  partial "dev/scratch/set-for-item-context" . }}

<!-- get filename without extension -->
{{ $pathBase := (index (split (path.Base .Path) ".") 0) }}

<!-- build path to component directory -->
{{ if not 
  (or 
    (eq (path.Base $pathBase) "index") 
    (eq (path.Base $pathBase) "_index") 
  )
}}
  {{ $scratch.Set "componentDirectoryPath" (printf "%s/%s" 
    (index (split .Path ".") 0) 
    ($scratch.Get "componentDirectory"))
  }}
{{ else }}
  {{ $scratch.Set "componentDirectoryPath" (printf "%s/%s" 
    (path.Dir .Path) 
    ($scratch.Get "componentDirectory"))
  }}
{{ end }}

<!-- get component directory root -->
{{ $componentDirectory := .GetPage ($scratch.Get "componentDirectoryPath") }}

<!-- get components in directory -->
{{ with $componentDirectory }}
  {{ $scratch.Set "components" (.Resources.ByType "page") }}
{{ end }}

<!-- return -->
{{ return $scratch.Get "components" }}
